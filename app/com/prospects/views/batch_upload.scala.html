@styles = {
  <!-- DataTables CSS -->
  <link href="@routes.Assets.at("bower_components/datatables-plugins/integration/bootstrap/3/dataTables.bootstrap.css")" rel="stylesheet">
  <!-- DataTables Responsive CSS -->
  <link href="@routes.Assets.at("bower_components/datatables-responsive/css/dataTables.responsive.css")" rel="stylesheet">
  <!-- Social Buttons CSS -->
  <link href="@routes.Assets.at("bower_components/bootstrap-social/bootstrap-social.css")" rel="stylesheet">

  <link href="@routes.Assets.at("stylesheets/application.css")" rel="stylesheet">
  <link href="@routes.Assets.at("stylesheets/jquery.steps.css")" rel="stylesheet">
}

@scripts = {

  <!-- DataTables JavaScript -->
  <script src="@routes.Assets.at("bower_components/datatables/media/js/jquery.dataTables.min.js")"></script>
  <script src="@routes.Assets.at("bower_components/datatables-plugins/integration/bootstrap/3/dataTables.bootstrap.min.js")"></script>
  <script src="@routes.Assets.at("bower_components/datatables-responsive/js/dataTables.responsive.js")"></script>

  <!-- JQuery Steps-->
  <script src="@routes.Assets.at("javascripts/jquery.steps-1.1.0/jquery.steps.js")"></script>

  <!-- Page-Level Demo Scripts - Tables - Use for reference -->
  <script>
    // We can attach the `fileselect` event to all file inputs on the page
    $(document).on('change', ':file', function() {
      var input = $(this),
                  numFiles = input.get(0).files ? input.get(0).files.length : 1,
                  label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
      input.trigger('fileselect', [numFiles, label]);
    });

    $(document).ready(function() {
      // We can watch for our custom `fileselect` event like this
      $(':file').on('fileselect', function(event, numFiles, label) {

        var input = $(this).parents('.input-group').find(':text'),
                    log = numFiles > 1 ? numFiles + ' files selected' : label;

        if( input.length ) {
          input.val(log);
        }
        else {
          if( log ) alert(log);
        }

      });

      var table = $('#dataTables-example').DataTable({
        ajax: {
          url: '@routes.ProspectController.loadPotentialProspects()',
          dataSrc: 'data',
          type: 'POST'
        },
        columns:[
          {data : '_id'},
          {data : 'fullname'},
          {data : 'identification'},
          {data : 'birthDate'},
          {data : 'country'},
          {data : 'primaryEmail'},
          {data : 'secondaryEmail'},
          {data : 'institution.name'},
          {data : 'entry'},
          {data : 'exit'},
          {data : 'code'},
          {data : 'title'}
        ],
        deferRender: true,
        responsive: true,
        scrollX : true
      });

      $(table).find('tbody').on( 'click', 'tr', function () {
        $(this).toggleClass('selected');
      } );

      var form = $("#batch-steps");

      form.children("div").steps({
        headerTag: "h3",
        bodyTag: "section",
        transitionEffect: "slide",
        onStepChanging: function(event, current, next){
          if(next === 1){
            var data = new FormData();
            $.each($('#file')[0].files,function(i, file){
              data.append('file[]', file);
            });

            $.ajax({
              url: '@routes.ProspectController.uploadFile',
              data : data,
              cache : false,
              contentType : false,
              processData : false,
              type : 'POST',
              success: function(response){
                if(response.status === 'OK'){
//                  console.log(response.status);
                  table.ajax.url( '@routes.ProspectController.loadPotentialProspects()' ).load();
                }
              },
              error: function(response){
                console.log(response.status);
                console.log(response.message);
              }
            });
          }
          return true;
        }
      });

    });
  </script>
}

@layout("Prospect Tracker | Batch Prospect Upload", scripts, styles){
  <div id="wrapper">
    <div id="page-wrapper">

      <div class="row">
        <div class="col-lg-12">
          <h1>Alta por Lote</h1>
        </div>
      </div>

      <div class="row">
        <div class="col-lg-12">
          <div class="panel panel-default">
            <div class="panel-body">
              @helper.form(action = routes.ProspectController.storeBatch(),'id  -> "batch-steps"){
                <div>
                  <h3>Carga de archivo (.csv)</h3>
                  <section>

                    <div class="col-lg-6 col-sm-6 col-12">
                      <div class="input-group">
                        <label class="input-group-btn">
                          <span class="btn btn-primary">Buscar&hellip;
                            <input id="file" type="file" name="csv" accept=".csv" style="display: none;" multiple>
                          </span>
                        </label>
                        <input type="text" class="form-control" readonly>
                      </div>
                      <span class="help-block">Seleccione uno o varios archivos .csv</span>
                    </div>
                  </section>

                  <h3>Potenciales Prospectos</h3>
                  <section>
                    <div class="dataTables_wrapper">
                      <table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example">
                        <thead>
                          <tr>
                            <th class="hidden">#</th>
                            <th>Nombre</th>
                            <th>Identificacion</th>
                            <th>Fecha de Nacimiento</th>
                            <th>País de Origen</th>
                            <th>Mail Primario</th>
                            <th>Mail Secundario</th>
                            <th>Institución</th>
                            <th>Ingreso</th>
                            <th>Egreso</th>
                            <th>Legajo</th>
                            <th>Título</th>
                          </tr>
                        </thead>
                      </table>
                    </div>
                  </section>
                </div>
              }
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
}